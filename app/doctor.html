<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<style type="text/css">
table.gridtable {
	font-family: verdana, arial, sans-serif;
	font-size: 11px;
	color: #333333;
	border-width: 1px;
	border-color: #666666;
	border-collapse: collapse;
}

table.gridtable th {
	border-width: 1px;
	padding: 8px;
	border-style: solid;
	border-color: #666666;
	background-color: #dedede;
}

table.gridtable td {
	border-width: 1px;
	padding: 8px;
	border-style: solid;
	border-color: #666666;
	background-color: #ffffff;
}
</style>

<!-- Table goes in the document BODY -->
<fieldset>
	<legend>SEARCH HISTORY TRANSACTIONS</legend>
	DoctorId: <input type="text" id="personId" name="personId"
		value="Your doctorID" size="20" maxlength="20"
		onfocus="if (this.value=='Your doctorID')  this.value='';" /> <input
		type="button" name="login" value="search your transactions"
		onclick="search()" />
	<table class="gridtable" id="table">
		<tr>
			<th>PatientId</th>
			<th>BillSymbol</th>
			<th>DiseaseInfo</th>
			<th>Consultation</th>
			<th>Price</th>
			<th>Pay condition</th>
		</tr>
	</table>
</fieldset>
<fieldset>
	<legend>SUBMIT PATIENT TRANSACTION</legend>
	<table width="300" height="0">
		<tr height="0">
			<td width="570px"></td>
			<td></td>
		</tr>
		<tr>
			<td></td>
			<td><table>
					<tr>
						<td>PatientId:</td>
						<td><input type="text" id="patientId" name="personId"
							size="20" maxlength="20" /></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>DoctorId:</td>
						<td><input type="text" id="doctorId" size="20"
							maxlength="20" /></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>Disease type:</td>
						<td><select id="disease">
								<option value="cancer">Cancer</option>
								<option value="aids">AIDS</option>
								<option value="burn">Burn</option>
								<option value="fracture">Fracture</option>
						</select></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>Consultation:</td>
						<td><input type="text" id="consultation" size="20"
							maxlength="20" /></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>Price:</td>
						<td><input type="number" id="price" size="20"
							maxlength="20" /></td>
						<td></td>
						<td></td>
					</tr>
					<!--  <tr> 
 <td>Hospital belong:</td>  
 <td><input type="text" id="unitBelong"name="UnitBelong" size="20" maxlength="20" /></td>
 <td> </td>  
 <td> </td> 
 </tr> -->
					<tr>
					</tr>
					<tr>
					</tr>
				</table></td>
		<tr>
			<td></td>
			<td><table>
					<tr>
						<td><input type="button" name="button"
							value="submit transaction" onclick="submit()"></td>
					</tr>
					</tr>
				</table></td>
	</table>

</fieldset>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
	function submit() {
		var patientId = document.getElementById("patientId").value;
		var doctorId = document.getElementById("doctorId").value;
		var diseaseInfo = document.getElementById("disease").value;
		var consultation = document.getElementById("consultation").value;
		var price = document.getElementById("price").value;
		var data = {
			"$class" : "org.example.mynetwork.SeeDoctor",
			"BillSymbol" : "003",
			"DiseaseInfo" : diseaseInfo,
			"Price" : price,
			"Consultation" : consultation,
			"patient" : "resource:org.example.mynetwork.Patient#"+ patientId,
			"doctor" : "resource:org.example.mynetwork.Doctor#"+ doctorId,
		}
		$.ajax({
			type : 'POST',
			url : "http://localhost:3000/api/SeeDoctor",
			data : JSON.stringify(data),
			contentType : "application/json",
			dataType : "json",
			error : function() {
				alert("Failed to submit the transaction!");
			},
			success : function(res) {
				alert("Success to submit a transaction!")
			}
		});
	}

	function search() {
		var personId = document.getElementById("personId").value;
		var data = {
			"doctor" : "resource:org.example.mynetwork.Doctor#" + personId
		}
		$.ajax({
			type : 'GET',
			url : "http://localhost:3000/api/queries/selectBillByDoctorId",
			data : data,
			contentType : "application/x-www-form-urlencoded",
			dataType : "json",
			error : function() {
				alert("Doctor does not exist!");
			},
			success : function(res) {
				var table = document.getElementById("table");
				table.innerHTML="";
				table.innerHTML="<tr><th>PatientId</th><th>BillSymbol</th><th>DiseaseInfo</th><th>Consultation</th><th>Price</th><th>Payment condition</th></tr>"
				for (var i = 0; i < res.length; i++) {
					var row = table.insertRow(table.rows.length);
					var c1 = row.insertCell(0);
					c1.innerHTML = res[i].patient;
					var c2 = row.insertCell(1);
					c2.innerHTML = res[i].BillSymbol;
					var c3 = row.insertCell(2);
					c3.innerHTML = res[i].DiseaseInfo;
					var c4 = row.insertCell(3);
					c4.innerHTML = res[i].Consultation;
					var c5 = row.insertCell(4);
					c5.innerHTML = res[i].Price;
					var c6 = row.insertCell(5);
					if (!res[i].isPaid) {
						c6.innerHTML = "unpaid";
					} else {
						c6.innerHTML = "paid";
					}
				}
			}
		});
	}
</script>
</body>
</html>
